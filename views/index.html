<html>

<head>
    <title>Application Login</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        function sendAPI(data, method, url) {
            var uid;

            $.ajax({
                type: method,
                url: 'http://localhost:3000/' + url,
                data: data,
                success: function (data) {
                    console.log("response of ", url, " is ", data);
                    if (data) {
                        if (url == 'users/register') {
                            $('#registerDiv').hide();
                            $('#dashboardDiv').show();
                            // uid = data._id.toString();
                            localStorage.setItem('uid', data._id.toString());
                        } else if (url == 'users/login') {
                            $('#loginDiv').hide();
                            $('#dashboardDiv').show();
                            // uid = data._id.toString();
                            localStorage.setItem('uid', data._id.toString());
                        }
                    } else {
                        alert("Something's going wrong in " + url);
                    }
                },
                error: function (xhr, type, exception) {
                    alert("Ajax error response type " + type);
                }
            });
        }

        function register() {
            console.log("register button called.");

            var reqData = {
                email: document.getElementById("regEmail").value,
                name: document.getElementById("regName").value,
                password: document.getElementById("regPassword").value
            }
            console.log("reqData ", reqData);

            sendAPI(reqData, 'POST', 'users/register');
        }

        function login() {
            console.log("Login button called.");

            var reqData = {
                email: document.getElementById("email").value,
                password: document.getElementById("password").value
            }
            console.log("reqData ", reqData);

            sendAPI(reqData, 'POST', 'users/login');
        }

        function getAllMessages() {
            var uid = localStorage.getItem('uid');
            console.log("Here the local stored uid " + uid);

            var reqData = {
                uid: localStorage.getItem('uid')
            }
            console.log("reqData ", reqData);

            sendAPI(reqData, 'POST', 'users/getAllMessages');
        }
    </script>

</head>

<body>
    <center>
        <div id="loginDiv">
            <h1>Login</h1>
            <table cellpadding="10px" cellspacing="10px">
                <tr>
                    <td>
                        Email
                    </td>
                    <td>
                        <input type="email" id="email" placeholder="Please enter Email">
                    </td>
                </tr>

                <tr>
                    <td>
                        Password
                    </td>
                    <td>
                        <input type="password" id="password" placeholder="Please enter password">
                    </td>
                </tr>

                <tr>
                    <td colspan="2" align="center">
                        <button id="loginButton" onclick="login()">Login</button>
                    </td>
                </tr>
            </table>
        </div>

        <div id="registerDiv" style="display: none;">
            <h1>Registration</h1>
            <table cellpadding="10px" cellspacing="10px">
                <tr>
                    <td>
                        Email
                    </td>
                    <td>
                        <input type="email" id="regEmail" placeholder="Please enter Email">
                    </td>
                </tr>

                <tr>
                    <td>
                        Name
                    </td>
                    <td>
                        <input type="text" id="regName" placeholder="Please enter Name">
                    </td>
                </tr>

                <tr>
                    <td>
                        Password
                    </td>
                    <td>
                        <input type="password" id="regPassword" placeholder="Please enter password">
                    </td>
                </tr>

                <tr>
                    <td colspan="2" align="center">
                        <button id="registerButton" onclick="register()">Register</button>
                    </td>
                </tr>
            </table>
        </div>

        <div id="dashboardDiv" style="display: none;">
            <button onclick="getAllMessages()">Get Mails</button>
        </div>

    </center>
</body>

</html>